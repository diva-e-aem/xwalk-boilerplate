{"version":3,"file":"header.js","sources":["../../src/blocks/header/header.ts"],"sourcesContent":["import { getMetadata } from '../../utils/getMetadata.js';\nimport { loadFragment } from '../fragment/fragment.js';\nimport './header.scss';\n\n// media query match that indicates mobile/tablet width\nconst isDesktop = window.matchMedia('(min-width: 900px)');\n\nfunction closeOnEscape(e) {\n  if (e.code === 'Escape') {\n    const nav = document.getElementById('nav');\n    const navSections = nav?.querySelector('.nav-sections');\n    const navSectionExpanded = navSections?.querySelector<HTMLElement>('[aria-expanded=\"true\"]');\n    if (navSectionExpanded && isDesktop.matches) {\n      // eslint-disable-next-line no-use-before-define\n      toggleAllNavSections(navSections);\n      navSectionExpanded.focus();\n    } else if (!isDesktop.matches) {\n      // eslint-disable-next-line no-use-before-define\n      toggleMenu(nav, navSections);\n      nav?.querySelector('button')?.focus();\n    }\n  }\n}\n\nfunction openOnKeydown(e) {\n  const focused = document.activeElement;\n  const isNavDrop = focused?.className === 'nav-drop';\n  if (isNavDrop && (e.code === 'Enter' || e.code === 'Space')) {\n    const dropExpanded = focused.getAttribute('aria-expanded') === 'true';\n    // eslint-disable-next-line no-use-before-define\n    toggleAllNavSections(focused.closest('.nav-sections'));\n    focused.setAttribute('aria-expanded', dropExpanded ? 'false' : 'true');\n  }\n}\n\nfunction focusNavSection() {\n  document.activeElement?.addEventListener('keydown', openOnKeydown);\n}\n\n/**\n * Toggles all nav sections\n * @param {Element} sections The container element\n * @param {Boolean} expanded Whether the element should be expanded or collapsed\n */\nfunction toggleAllNavSections(sections, expanded = false) {\n  sections.querySelectorAll('.nav-sections .default-content-wrapper > ul > li').forEach((section) => {\n    section.setAttribute('aria-expanded', expanded);\n  });\n}\n\n/**\n * Toggles the entire nav\n * @param {Element} nav The container element\n * @param {Element} navSections The nav sections within the container element\n * @param {*} forceExpanded Optional param to force nav expand behavior when not null\n */\nfunction toggleMenu(nav, navSections, forceExpanded: boolean | null = null) {\n  const expanded = forceExpanded !== null ? !forceExpanded : nav.getAttribute('aria-expanded') === 'true';\n  const button = nav.querySelector('.nav-hamburger button');\n  document.body.style.overflowY = expanded || isDesktop.matches ? '' : 'hidden';\n  nav.setAttribute('aria-expanded', expanded ? 'false' : 'true');\n  toggleAllNavSections(navSections, expanded || isDesktop.matches ? false : true);\n  button.setAttribute('aria-label', expanded ? 'Open navigation' : 'Close navigation');\n  // enable nav dropdown keyboard accessibility\n  const navDrops = navSections.querySelectorAll('.nav-drop');\n  if (isDesktop.matches) {\n    navDrops.forEach((drop) => {\n      if (!drop.hasAttribute('tabindex')) {\n        drop.setAttribute('role', 'button');\n        drop.setAttribute('tabindex', 0);\n        drop.addEventListener('focus', focusNavSection);\n      }\n    });\n  } else {\n    navDrops.forEach((drop) => {\n      drop.removeAttribute('role');\n      drop.removeAttribute('tabindex');\n      drop.removeEventListener('focus', focusNavSection);\n    });\n  }\n  // enable menu collapse on escape keypress\n  if (!expanded || isDesktop.matches) {\n    // collapse menu on escape press\n    window.addEventListener('keydown', closeOnEscape);\n  } else {\n    window.removeEventListener('keydown', closeOnEscape);\n  }\n}\n\n/**\n * loads and decorates the header, mainly the nav\n * @param {Element} block The header block element\n */\nexport default async function decorate(block) {\n  // load nav as fragment\n  const navMeta = getMetadata('nav');\n  const navPath = navMeta ? new URL(navMeta, window.location.origin).pathname : '/nav';\n  const fragment = await loadFragment(navPath);\n\n  // decorate nav DOM\n  block.textContent = '';\n  const nav = document.createElement('nav');\n  nav.id = 'nav';\n  if (fragment) {\n    while (fragment.firstElementChild) nav.append(fragment.firstElementChild);\n  }\n\n  const classes = ['brand', 'sections', 'tools'];\n  classes.forEach((c, i) => {\n    const section = nav.children[i];\n    if (section) section.classList.add(`nav-${c}`);\n  });\n\n  const navBrand = nav.querySelector('.nav-brand');\n  const brandLink = navBrand?.querySelector('.button');\n  if (brandLink) {\n    brandLink.className = '';\n    const closestElement = brandLink.closest('.button-container');\n    if (closestElement) closestElement.className = '';\n  }\n\n  const navSections = nav.querySelector('.nav-sections');\n  if (navSections) {\n    navSections.querySelectorAll(':scope .default-content-wrapper > ul > li').forEach((navSection) => {\n      if (navSection.querySelector('ul')) navSection.classList.add('nav-drop');\n      navSection.addEventListener('click', () => {\n        if (isDesktop.matches) {\n          const expanded = navSection.getAttribute('aria-expanded') === 'true';\n          toggleAllNavSections(navSections);\n          navSection.setAttribute('aria-expanded', expanded ? 'false' : 'true');\n        }\n      });\n    });\n  }\n\n  // hamburger for mobile\n  const hamburger = document.createElement('div');\n  hamburger.classList.add('nav-hamburger');\n  hamburger.innerHTML = `<button type=\"button\" aria-controls=\"nav\" aria-label=\"Open navigation\">\n      <span class=\"nav-hamburger-icon\"></span>\n    </button>`;\n  hamburger.addEventListener('click', () => toggleMenu(nav, navSections));\n  nav.prepend(hamburger);\n  nav.setAttribute('aria-expanded', 'false');\n  // prevent mobile nav behavior on window resize\n  toggleMenu(nav, navSections, isDesktop.matches);\n  isDesktop.addEventListener('change', () => toggleMenu(nav, navSections, isDesktop.matches));\n\n  const navWrapper = document.createElement('div');\n  navWrapper.className = 'nav-wrapper';\n  navWrapper.append(nav);\n  block.append(navWrapper);\n}\n"],"names":["isDesktop","closeOnEscape","e","nav","navSections","navSectionExpanded","toggleAllNavSections","toggleMenu","_a","openOnKeydown","focused","dropExpanded","focusNavSection","sections","expanded","section","forceExpanded","button","navDrops","drop","decorate","block","navMeta","getMetadata","navPath","fragment","loadFragment","c","i","navBrand","brandLink","closestElement","navSection","hamburger","navWrapper"],"mappings":"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"}